{"ts":1357943041972,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"dojo.require(\"esri.map\");\r\ndojo.require(\"esri.dijit.Legend\");\r\ndojo.require(\"esri.dijit.Scalebar\");\r\ndojo.require(\"esri.arcgis.utils\");\r\ndojo.require(\"esri.IdentityManager\");\r\ndojo.require(\"dijit.dijit\"); // optimize: load dijit layer\r\ndojo.require(\"dijit.layout.BorderContainer\");\r\ndojo.require(\"dijit.layout.ContentPane\");\r\ndojo.require(\"esri.dijit.TimeSlider\");\r\ndojo.require(\"dojox.fx\");\r\ndojo.requireLocalization(\"esriTemplate\",\"template\");\r\n\r\nvar urlObject, i18n, _maps = [], timeoutComplete = false, timeSlider, _timeProperties = [], timeInterface = false, _thumbIndexes = [], mapsLoaded = 0, mapsReady = false, isPlaying = false, cm, mapExtent;\r\n\r\nvar toBoolean = function (str) {\r\n  switch (str.toLowerCase ()) {\r\n    case \"true\":\r\n      return true;\r\n    case \"false\":\r\n      return false;\r\n    default:\r\n      return true;\r\n  }\r\n};\r\n\r\nfunction initMap(){\r\n    patchID();\r\n\r\n    dojo.some([\"ar\",\"he\"], function(l){\r\n         if(dojo.locale.indexOf(l) !== -1){\r\n           configOptions.isRightToLeft = true;\r\n           return true;\r\n         }\r\n       });\r\n       var dirNode = document.getElementsByTagName(\"html\")[0];\r\n       if(configOptions.isRightToLeft){\r\n         dirNode.setAttribute(\"dir\",\"rtl\");\r\n         dojo.addClass( dirNode,\"esriRtl\");\r\n         //Page Specific\r\n         dijit.byId(\"leftPane\").attr(\"region\",\"right\");\r\n         dijit.byId(\"logoArea\").attr(\"region\",\"left\");\r\n       }else{\r\n         dirNode.setAttribute(\"dir\",\"ltr\");\r\n         dojo.addClass(dirNode,\"esriLtr\");\r\n         //Page Specific\r\n         dijit.byId(\"leftPane\").attr(\"region\",\"left\");\r\n         dijit.byId(\"logoArea\").attr(\"region\",\"right\");\r\n       }\r\n\r\n\ti18n = dojo.i18n.getLocalization(\"esriTemplate\",\"template\");\r\n\tdojo.byId('loading').innerHTML = i18n.viewer.loading.message;\r\n\tdojo.byId('legendHeaderText').innerHTML = i18n.viewer.sidePanel.legendHeader;\r\n\r\n      if(configOptions.geometryserviceurl && location.protocol === \"https:\"){\r\n        configOptions.geometryserviceurl = configOptions.geometryserviceurl.replace('http:','https:');\r\n      }\r\n      esri.config.defaults.geometryService = new esri.tasks.GeometryService(configOptions.geometryserviceurl);\r\n\r\n\r\n\r\n      if(!configOptions.sharingurl){\r\n        configOptions.sharingurl = location.protocol + '//' + location.host + \"/sharing/content/items\";\r\n      }\r\n      esri.arcgis.utils.arcgisUrl = configOptions.sharingurl;\r\n\r\n      if(!configOptions.proxyurl){\r\n        configOptions.proxyurl = location.protocol + '//' + location.host + \"/sharing/proxy\";\r\n      }\r\n\r\n      esri.config.defaults.io.proxyUrl =  configOptions.proxyurl;\r\n\r\n      esri.config.defaults.io.alwaysUseProxy = false;\r\n\r\n      urlObject = esri.urlToObject(document.location.href);\r\n      urlObject.query = urlObject.query || {};\r\n\r\n      if(urlObject.query.title){\r\n        configOptions.title = urlObject.query.title;\r\n      }\r\n      if(urlObject.query.subtitle){\r\n        configOptions.subtitle = urlObject.query.subtitle;\r\n      }\r\n\t  if(urlObject.query.description){\r\n        configOptions.description = urlObject.query.description;\r\n      }\r\n\t  if(urlObject.query.displayDescription){\r\n        configOptions.displayDescription = toBoolean(urlObject.query.displayDescription);\r\n      }\r\n\t  if(urlObject.query.displayLegend){\r\n        configOptions.displayLegend = toBoolean(urlObject.query.displayLegend);\r\n      }\r\n\t  if(urlObject.query.loop){\r\n        configOptions.loop = toBoolean(urlObject.query.loop);\r\n      }\r\n\t  if(urlObject.query.syncMaps){\r\n        configOptions.syncMaps = toBoolean(urlObject.query.syncMaps);\r\n      }\r\n      if(urlObject.query.webmap){\r\n          if (dojo.isArray(urlObject.query.webmap) == false && getWebMaps(urlObject.query.webmap).length > 1){\r\n            configOptions.webmaps = getWebMaps(urlObject.query.webmap);\r\n            if(urlObject.query.tabs){\r\n              configOptions.tabTitles = getTabs(urlObject.query.tabs);\r\n            }\r\n          }\r\n\t\t  else if (dojo.isArray(urlObject.query.webmap) == false){\r\n        \tconfigOptions.webmaps[0].id = urlObject.query.webmap;\r\n\t\t  }\r\n\t\t  else{\r\n\t\t\tdojo.forEach(urlObject.query.webmap,function(webmap,i){\r\n\t\t\t  configOptions.webmaps[i] = {\"id\": webmap};\r\n\t\t\t  if(urlObject.query.tabTitle){\r\n\t\t\t\t  if (configOptions.tabTitles[i] == null || configOptions.tabTitles[i].title == \"\"){\r\n\t\t\t\t\t  if (dojo.isArray(urlObject.query.tabTitle) == false){\r\n\t\t\t\t\t\tif (i == 0){\r\n\t\t\t\t\t\t\tconfigOptions.tabTitles[0] = {\"title\": urlObject.query.tabTitle} || {\"title\": \"\"};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\tconfigOptions.tabTitles[i] = {\"title\": \"\"};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t  }\r\n\t\t\t\t\t  else{\r\n\t\t\t\t\t\tconfigOptions.tabTitles[i] = {\"title\": urlObject.query.tabTitle[i]} || {\"title\": \"\"};\r\n\t\t\t\t\t  }\r\n\t\t\t\t  }\r\n\t\t\t  }\r\n\t\t\t  else{\r\n\t\t\t\t  configOptions.tabTitles[i] = {\"title\": \"\"};\r\n\t\t\t  }\r\n\t\t\t});\r\n\t\t  }\r\n      }\r\n      if(urlObject.query.bingMapsKey){\r\n        configOptions.bingmapskey = urlObject.query.bingMapsKey;\r\n      }\r\n\r\n\t  //is an appid specified - if so read json from there\r\n\t  if(configOptions.appid || (urlObject.query && urlObject.query.appid)){\r\n\t\tvar appid = configOptions.appid || urlObject.query.appid;\r\n\t\tvar requestHandle = esri.request({\r\n\t\t  url: configOptions.sharingurl + \"/\" + appid + \"/data\",\r\n\t\t  content: {f:\"json\"},\r\n\t\t  callbackParamName:\"callback\",\r\n\t\t  load: function(response){\r\n\t\t\t   if(response.values.title !== undefined){configOptions.title = response.values.title;}\r\n\t\t\t   if(response.values.subtitle !== undefined){configOptions.subtitle = response.values.subtitle;}\r\n\t\t\t   if(response.values.description !== undefined){configOptions.description = response.values.description;}\r\n\t\t\t   if(response.values.loop !== undefined){configOptions.loop = response.values.loop;}\r\n\t\t\t   if(response.values.displayDescription !== undefined){configOptions.displayDescription = response.values.displayDescription; }\r\n\t\t\t   if(response.values.displayLegend !== undefined) {configOptions.displayLegend = response.values.displayLegend;}\r\n\t\t\t   if(response.values.syncMaps !== undefined) {configOptions.syncMaps = response.values.syncMaps;}\r\n\t\t\t   if(response.values.webmap !== undefined) {configOptions.webmaps = getWebMaps(response.values.webmap);}\r\n\t\t\t   if(response.values.tabs !== undefined) {configOptions.tabTitles = getTabs(response.values.tabs);}\r\n\r\n\t\t\t   createMap();\r\n\t\t  },\r\n\t\t  error: function(response){\r\n\t\t\tvar e = response.message;\r\n\t\t   alert(i18n.viewer.errors.createMap +  response.message);\r\n\t\t  }\r\n\t\t});\r\n\t\t }else{\r\n\t\t\tcreateMap();\r\n\t\t }\r\n}\r\n\r\nfunction createMap(){\r\n\tdojo.forEach(configOptions.webmaps, function(arg,i){\r\n\r\n\t\tif(configOptions.tabTitles[i] == null){\r\n\t\t\tconfigOptions.tabTitles[i] = {\"title\": \"\"};\r\n\t\t}\r\n\r\n\t\tdojo.place(\"<div id='mapDiv\"+i+\"' class='map'></div>\",dojo.byId('mapPane'),\"last\");\r\n\t\tif (configOptions.webmaps.length > 1){\r\n\t\t\tdojo.place(\"<h3 id='title\"+i+\"' class='mapTitle'></h3>\",dojo.byId('descriptionPanel'),\"last\");\r\n\t\t\tdojo.place(\"<div id='tab\"+i+\"' class='tab' onclick='changeMap(\"+i+\")'><p id='tabText\"+i+\"' class='tabText'></p></div>\",dojo.byId('tabArea'),\"last\");\r\n\t\t\tdojo.addClass(dojo.byId(\"tab0\"),\"selected\");\r\n\t\t}\r\n\t\tdojo.place(\"<div id='description\"+i+\"' class='description'></div>\",dojo.byId('descriptionPanel'),\"last\");\r\n\t\tdojo.place(\"<div id='legend\"+i+\"' class='legend'></div>\",dojo.byId('legendPanel'),\"last\");\r\n\r\n\t\tvar mapDeferred = esri.arcgis.utils.createMap(arg.id, \"mapDiv\"+i, {\r\n\t\t\tmapOptions: {\r\n\t\t\t\tslider: true,\r\n\t\t\t\tnav: false,\r\n\t\t\t\twrapAround180:true\r\n\t\t\t},\r\n\t\t\tignorePopups:false,\r\n\t\t\tbingMapsKey: configOptions.bingmapskey\r\n\t\t});\r\n\r\n\t\tmapDeferred.addCallback(function (response) {\r\n\r\n\t\t\tvar map = response.map\r\n\t\t\t_maps[i] = map;\r\n\r\n\t\t\tdojo.connect(map,'onClick',stopTime);\r\n\t\t\tdojo.connect(map,'onExtentChange',syncExtents)\r\n\t\t\tdojo.connect(map,\"onUpdateEnd\",function(){\r\n\t\t\t\tmapLoaded();\r\n\t\t\t\tplayAnimation();\r\n\t\t\t});\r\n\r\n\t\t\tif (i == 0){\r\n\t\t\t\tdocument.title = configOptions.title|| response.itemInfo.item.title || \"\";\r\n        \t\tdojo.byId(\"title\").innerHTML = configOptions.title ||response.itemInfo.item.title || \"\";\r\n        \t\tdojo.byId(\"subtitle\").innerHTML = configOptions.subtitle|| response.itemInfo.item.snippet || \"\";\r\n\t\t\t\tdojo.byId(\"description0\").innerHTML = configOptions.description|| response.itemInfo.item.description || \"\";\r\n\t\t\t\tif (configOptions.webmaps.length > 1){\r\n\t\t\t\t\tdojo.byId(\"title0\").innerHTML = response.itemInfo.item.title || \"\";\r\n\t\t\t\t\tdojo.byId(\"description0\").innerHTML = response.itemInfo.item.description || \"\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (configOptions.webmaps.length > 1){\r\n\t\t\t\tdojo.byId(\"tabText\"+i).innerHTML = configOptions.tabTitles[i].title || response.itemInfo.item.title || \"\";\r\n\t\t\t\tdojo.byId(\"title\"+i).innerHTML = response.itemInfo.item.title || \"\";\r\n\t\t\t\tdojo.byId(\"description\"+i).innerHTML = response.itemInfo.item.description || \"\";\r\n\t\t\t}\r\n\r\n\t\t\tvar layers = response.itemInfo.itemData.operationalLayers;\r\n\r\n\t\t\tif(response.itemInfo.itemData.widgets && response.itemInfo.itemData.widgets.timeSlider){\r\n\t\t\t\t_timeProperties[i] =  response.itemInfo.itemData.widgets.timeSlider.properties;\r\n\t\t\t\ttimeInterface = true;\r\n\t\t\t}\r\n\t\t\taddTabsAndTime();\r\n\r\n\t\t\tif(map.loaded){\r\n          \t\tinitUI(layers,i,map);\r\n        \t}\r\n        \telse{\r\n          \t\tdojo.connect(map,\"onLoad\",function(){\r\n\t\t\t\t\tinitUI(layers,i,map);\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n        \t//resize the map when the browser resizes\r\n\t\t\tdojo.connect(dijit.byId('mapPane'), 'resize', function(){\r\n\t\t\t\tdojo.forEach(_maps,function(map){\r\n\t\t\t\t\tif (map != null){\r\n\t\t\t\t\t\tmap.resize();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tcenterTimeDisplay();\r\n\t\t\t});\r\n\r\n\t  \t});\r\n\r\n      mapDeferred.addErrback(function (error) {\r\n          alert(i18n.viewer.errors.createMap + \" \" + dojo.toJson(error.message));\r\n\t\t  mapsLoaded = configOptions.webmaps.length - 1;\r\n\t\t  mapLoaded();\r\n\t\t  dojo.destroy(dojo.byId(\"tab\"+i));\r\n\t\t  if (i==0){\r\n\t\t      alert(i18n.viewer.errors.timeout);\r\n\t\t  }\r\n      });\r\n\r\n\t});\r\n\r\n\tsetupLayout();\r\n}\r\n\r\n\r\nfunction initUI(layers,index,map) {\r\n\t//add chrome theme for popup\r\n    dojo.addClass(map.infoWindow.domNode, \"chrome\");\r\n    //add the scalebar\r\n    var scalebar = new esri.dijit.Scalebar({\r\n\t\tmap: map,\r\n        scalebarUnit: i18n.viewer.main.scaleBarUnits //metric or english\r\n    });\r\n\r\n    var layerInfo = buildLayersList(layers);\r\n\r\n    if(layerInfo.length > 0){\r\n\t\tvar legendDijit = new esri.dijit.Legend({\r\n\t\t\tmap:map,\r\n\t\t\tlayerInfos:layerInfo\r\n\t\t},\"legend\"+index);\r\n        legendDijit.startup();\r\n    }\r\n    else{\r\n        dojo.byId(\"legend\"+index).innerHTML = \"\";\r\n    }\r\n\tif (timeSlider == null){\r\n\t\tif(_timeProperties[index] != null){\r\n\t\t\tif(cm == null){\r\n\t\t\t\tcm = index;\r\n\t\t\t}\r\n\r\n\t\t\tvar startTime = _timeProperties[index].startTime;\r\n\t\t\tvar endTime = _timeProperties[index].endTime;\r\n\t\t    var fullTimeExtent = new esri.TimeExtent(new Date(startTime), new Date(endTime));\r\n\t\t\tmap.setTimeExtent(fullTimeExtent);\r\n\r\n\t\t\ttimeSlider = new esri.dijit.TimeSlider({\r\n\t\t\t\tstyle: \"width: 100%;\",\r\n\t\t\t\tloop: configOptions.loop\r\n\t\t  \t}, dojo.byId(\"timeSliderDiv\"));\r\n\r\n\t\t\tmap.setTimeSlider(timeSlider);\r\n\r\n\t\t\ttimeSlider.setThumbCount(_timeProperties[index].thumbCount);\r\n\t\t    timeSlider.setThumbMovingRate(_timeProperties[index].thumbMovingRate);\r\n\r\n\t\t\tif(_timeProperties[index].numberOfStops){\r\n\t\t\t\ttimeSlider.createTimeStopsByCount(fullTimeExtent,_timeProperties[index].numberOfStops);\r\n\t\t  \t}\r\n\t\t\telse{\r\n\t\t\t\ttimeSlider.createTimeStopsByTimeInterval(fullTimeExtent,_timeProperties[index].timeStopInterval.interval,_timeProperties[index].timeStopInterval.units);\r\n\t\t  \t}\r\n\r\n\t\t  \tif(timeSlider.thumbCount == 2){\r\n\t\t\t\ttimeSlider.setThumbIndexes([0,1]);\r\n\t\t  \t}\r\n\r\n\t\t\tdojo.connect(timeSlider,'onTimeExtentChange',function(timeExtent){\r\n\r\n\t\t\t\tvar timeCon = dojo.query(\"#timeSliderDiv > table > tbody > tr > td\");\r\n\t\t\t\tdojo.place(\"<img id='playPause' class='timeControl' src='images/playIcon.png' alt='' onClick='animate()'>\",timeCon[0],'last');\r\n\t\t\t\tdojo.place(\"<img id='prev' class='timeControl' src='images/prevIcon.png' alt='' onClick='prevTime()'>\",timeCon[2],'last');\r\n\t\t\t\tdojo.place(\"<img id='next' class='timeControl' src='images/nextIcon.png' alt='' onClick='nextTime()'>\",timeCon[3],'last');\r\n\r\n\t\t\t\t_thumbIndexes[cm] = timeSlider.thumbIndexes\r\n\t\t\t\twaitForLoad();\r\n\t\t\t\tvar timeString;\r\n\t\t\t\tif(_timeProperties[cm].timeStopInterval !== undefined){\r\n\t\t\t\t\tswitch(_timeProperties[cm].timeStopInterval.units){\r\n\t\t\t\t\t\tcase 'esriTimeUnitsCenturies':\r\n\t\t\t  \t\t\t\tdatePattern = 'yyyy G'\r\n\t\t\t  \t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'esriTimeUnitsDecades':\r\n\t\t\t  \t\t\t\tdatePattern = 'yyyy'\r\n\t\t\t  \t\t\t\tbreak;\r\n\t\t\t \t\t\tcase 'esriTimeUnitsYears':\r\n\t\t\t  \t\t\t\tdatePattern = 'MMMM yyyy'\r\n\t\t\t \t\t\t\t break;\r\n\t\t\t\t\t\tcase 'esriTimeUnitsWeeks':\r\n\t\t\t  \t\t\t\tdatePattern = 'MMMM d, yyyy'\r\n\t\t\t  \t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'esriTimeUnitsDays':\r\n\t\t\t  \t\t\t\tdatePattern = 'MMMM d, yyyy'\r\n\t\t\t  \t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'esriTimeUnitsHours':\r\n\t\t\t  \t\t\t\tdatePattern = 'h:m:s.SSS a'\r\n\t\t\t  \t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'esriTimeUnitsMilliseconds':\r\n\t\t\t  \t\t\t\tdatePattern = 'h:m:s.SSS a'\r\n\t\t\t  \t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'esriTimeUnitsMinutes':\r\n\t\t\t  \t\t\t\tdatePattern = 'h:m:s.SSS a'\r\n\t\t\t \t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'esriTimeUnitsMonths':\r\n\t\t\t  \t\t\t\tdatePattern = 'MMMM d, y'\r\n\t\t\t  \t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'esriTimeUnitsSeconds':\r\n\t\t\t  \t\t\t\tdatePattern = 'h:m:s.SSS a'\r\n\t\t\t  \t\t\t\tbreak;\r\n\t\t  \t\t\t}\r\n\t\t   \t\t\ttimeString = formatDate(timeExtent.startTime,datePattern) + \" to \" + formatDate(timeExtent.endTime,datePattern);\r\n\t\t  \t\t}\r\n\t\t  \t\telse{\r\n\t\t\t\t\ttimeString = formatDate(timeExtent.endTime,'MMMM d,yyyy');\r\n\t\t  \t\t}\r\n\r\n\t\t\tdojo.byId('timeDisplay').innerHTML = timeString;\r\n\r\n\t\t\tcenterTimeDisplay();\r\n\r\n\t\t  });\r\n\r\n\t\t\ttimeSlider.startup();\r\n\r\n\t\t\tdojo.forEach(dojo.query(\".timeControl\"),function(qry){\r\n\t\t\t\tdojo.style(qry,\"display\",\"block\");\r\n\t\t\t});\r\n\t\t\tdojo.place(\"<div id='timeSliderBlind'></div>\",dojo.byId(\"timeSliderArea\"),\"last\");\r\n\t\t\tdojo.style(dojo.byId(\"timeSliderBlind\"),\"opacity\", \"0.8\");\r\n\r\n\t\t\tdojo.connect(dojo.byId(\"next\"),'onmousedown',function(){\r\n\t\t\t\tdojo.byId(\"next\").setAttribute(\"src\",\"images/nextIconDark.png\");\r\n\t\t\t});\r\n\t\t\tdojo.connect(dojo.byId(\"next\"),\"onmouseup\",function(){\r\n\t\t\t\tdojo.byId(\"next\").setAttribute(\"src\",\"images/nextIcon.png\");\r\n\t\t\t});\r\n\t\t\tdojo.connect(dojo.byId(\"prev\"),'onmousedown',function(){\r\n\t\t\t\tdojo.byId(\"prev\").setAttribute(\"src\",\"images/prevIconDark.png\");\r\n\t\t\t});\r\n\t\t\tdojo.connect(dojo.byId(\"prev\"),\"onmouseup\",function(){\r\n\t\t\t\tdojo.byId(\"prev\").setAttribute(\"src\",\"images/prevIcon.png\");\r\n\t\t\t});\r\n\t\t\tdojo.connect(dojo.byId(\"playPause\"),'onmousedown',function(){\r\n\t\t\t\tif (dojo.attr(dojo.byId(\"playPause\"),\"src\") == \"images/playIcon.png\"){\r\n\t\t\t\t\tdojo.byId(\"playPause\").setAttribute(\"src\",\"images/playIconDark.png\");\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tdojo.byId(\"playPause\").setAttribute(\"src\",\"images/pauseIconDark.png\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n//build a list of layers to dispaly in the legend\r\n  function buildLayersList(layers){\r\n\r\n //layers  arg is  response.itemInfo.itemData.operationalLayers;\r\n  var layerInfos = [];\r\n  dojo.forEach(layers, function (mapLayer, index) {\r\n      var layerInfo = {};\r\n      if (mapLayer.featureCollection && mapLayer.type !== \"CSV\") {\r\n        if (mapLayer.featureCollection.showLegend === true) {\r\n            dojo.forEach(mapLayer.featureCollection.layers, function (fcMapLayer) {\r\n              if (fcMapLayer.showLegend !== false) {\r\n                  layerInfo = {\r\n                      \"layer\": fcMapLayer.layerObject,\r\n                      \"title\": mapLayer.title,\r\n                      \"defaultSymbol\": false\r\n                  };\r\n                  if (mapLayer.featureCollection.layers.length > 1) {\r\n                      layerInfo.title += \" - \" + fcMapLayer.layerDefinition.name;\r\n                  }\r\n                  layerInfos.push(layerInfo);\r\n              }\r\n            });\r\n          }\r\n      } else if (mapLayer.showLegend !== false && mapLayer.layerObject) {\r\n      var showDefaultSymbol = false;\r\n      if (mapLayer.layerObject.version < 10.1 && (mapLayer.layerObject instanceof esri.layers.ArcGISDynamicMapServiceLayer || mapLayer.layerObject instanceof esri.layers.ArcGISTiledMapServiceLayer)) {\r\n        showDefaultSymbol = true;\r\n      }\r\n      layerInfo = {\r\n        \"layer\": mapLayer.layerObject,\r\n        \"title\": mapLayer.title,\r\n        \"defaultSymbol\": showDefaultSymbol\r\n      };\r\n        //does it have layers too? If so check to see if showLegend is false\r\n        if (mapLayer.layers) {\r\n            var hideLayers = dojo.map(dojo.filter(mapLayer.layers, function (lyr) {\r\n                return (lyr.showLegend === false);\r\n            }), function (lyr) {\r\n                return lyr.id;\r\n            });\r\n            if (hideLayers.length) {\r\n                layerInfo.hideLayers = hideLayers;\r\n            }\r\n        }\r\n        layerInfos.push(layerInfo);\r\n    }\r\n  });\r\n  return layerInfos;\r\n  }\r\n\r\n\r\n\r\nfunction formatDate(date,datePattern){\r\n\treturn dojo.date.locale.format(date, {\r\n    \tselector: 'date',\r\n        datePattern: datePattern\r\n\t});\r\n}\r\n\r\nfunction mapLoaded(){\r\n\tvar timeout = setTimeout(\"timeoutError()\",10000);\r\n\tif (mapsLoaded == configOptions.webmaps.length - 1){\r\n\t\tif (mapsLoaded == configOptions.webmaps.length - 1){\r\n\t\t\tif (configOptions.webmaps.length == 1){\r\n\t\t\t\tif (_timeProperties[0] != null){\r\n\t\t\t\t\tdojo.style(dojo.byId(\"tabArea\"),\"height\",\"0px\");\r\n\t\t\t\t\tdojo.style(dojo.byId(\"banner\"),\"height\",\"165px\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdojo.forEach(_maps,function(map,i){\r\n\t\t\t\tif (i != 0){\r\n\t\t\t\t\tdojo.fadeOut({\r\n\t\t\t\t\t\tnode: dojo.byId(\"mapDiv\"+i),\r\n\t\t\t\t\t\tduration: 300\r\n\t\t\t\t\t}).play();\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tdojo.style(dojo.byId(\"legend\"+i),\"display\",\"block\");\r\n\t\t\t\t\tdojo.style(dojo.byId(\"description\"+i),\"display\",\"block\");\r\n\t\t\t\t\tif (configOptions.webmaps.length > 1){\r\n\t\t\t\t\t\tdojo.style(dojo.byId(\"title\"+i),\"display\",\"block\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tdojo.place(dojo.byId('mapDiv0'),dojo.byId('mapPane'),'last');\r\n\t\t\tdojo.fadeOut({\r\n\t\t\t\tnode: dojo.byId(\"mapBlind\"),\r\n\t\t\t\tduration: 500\r\n\t\t\t}).play();\r\n\t\t\tvar t = setTimeout(\"dojo.style(dojo.byId('mapBlind'),'display','none')\",500);\r\n\t\t\tif (_timeProperties[0] == null){\r\n\t\t\t\tdojo.fadeOut({\r\n\t\t\t\t\tnode: dojo.byId(\"timeDisplay\"),\r\n\t\t\t\t\tduration: 1\r\n\t\t\t\t}).play();\r\n\t\t\t\tdojo.style(dojo.byId('timeDisplay'),'z-index','0');\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tdojo.fadeOut({\r\n\t\t\t\t\tnode: dojo.byId(\"timeSliderBlind\"),\r\n\t\t\t\t\tduration: 500\r\n\t\t\t\t}).play();\r\n\t\t\t\tvar t = setTimeout(\"dojo.style(dojo.byId('timeSliderBlind'),'display','none')\",500);\r\n\t\t\t}\r\n\t\t\tmapsReady = true;\r\n\t\t\tmapsLoaded++\r\n\t\t\tdijit.byId(\"mainWindow\").layout();\r\n\t\t\tcm = 0;\r\n\t\t\tsyncExtents();\r\n\t\t\tesri.hide(dojo.byId(\"loadingCon\"));\r\n\t\t}\r\n\t\telse{\r\n\t\t\tmapsLoaded++\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nfunction animate(){\r\n\tif(_timeProperties[cm] != null){\r\n\t\tif (isPlaying == false){\r\n\t\t\tisPlaying = true;\r\n\t\t\tplayAnimation();\r\n\t\t\tdojo.byId(\"playPause\").setAttribute(\"src\",\"images/pauseIcon.png\");\r\n\t\t}\r\n\t\telse{\r\n\t\t\tisPlaying = false;\r\n\t\t\ttimeSlider.pause();\r\n\t\t\tdojo.byId(\"playPause\").setAttribute(\"src\",\"images/playIcon.png\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction stopTime(){\r\n\tif (timeSlider){\r\n\t\tisPlaying = false;\r\n\t\ttimeSlider.pause();\r\n\t\tdojo.byId(\"playPause\").setAttribute(\"src\",\"images/playIcon.png\");\r\n\t}\r\n}\r\n\r\nfunction playAnimation(){\r\n\tif(_timeProperties[cm] != null){\r\n\t\tif (isPlaying == true){\r\n\t\t\ttimeSlider.play();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction waitForLoad(){\r\n\tif(_timeProperties[cm] != null){\r\n\t\ttimeSlider.pause();\r\n\t}\r\n}\r\n\r\nfunction prevTime(){\r\n\tif(_timeProperties[cm] != null){\r\n\t\tisPlaying = false;\r\n\t\ttimeSlider.pause();\r\n\t\tdojo.byId(\"playPause\").setAttribute(\"src\",\"images/playIcon.png\");\r\n\t\ttimeSlider.previous();\r\n\t}\r\n}\r\n\r\nfunction nextTime(){\r\n\tif(_timeProperties[cm] != null){\r\n\t\tisPlaying = false;\r\n\t\ttimeSlider.pause();\r\n\t\tdojo.byId(\"playPause\").setAttribute(\"src\",\"images/playIcon.png\");\r\n\t\ttimeSlider.next();\r\n\t}\r\n}\r\n\r\nfunction syncExtents(){\r\n\tif (configOptions.syncMaps == true){\r\n\t\tif (_maps[cm]){\r\n\t\t\tif (_maps[cm].extent != mapExtent){\r\n\t\t\t\tmapExtent = _maps[cm].extent;\r\n\t\t\t\tdojo.forEach(_maps,function(map,i){\r\n\t\t\t\t\tif (i != cm){\r\n\t\t\t\t\t\tif(map){\r\n\t\t\t\t\t\t\tmap.setExtent(mapExtent);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction patchID() {  //patch id manager for use in apps.arcgis.com\r\n       esri.id._isIdProvider = function(server, resource) {\r\n       // server and resource are assumed one of portal domains\r\n\r\n       var i = -1, j = -1;\r\n\r\n       dojo.forEach(this._gwDomains, function(domain, idx) {\r\n         if (i === -1 && domain.regex.test(server)) {\r\n           i = idx;\r\n         }\r\n         if (j === -1 && domain.regex.test(resource)) {\r\n           j = idx;\r\n         }\r\n       });\r\n\r\n       var retVal = false;\r\n\r\n       if (i > -1 && j > -1) {\r\n         if (i === 0 || i === 4) {\r\n           if (j === 0 || j === 4) {\r\n             retVal = true;\r\n           }\r\n         }\r\n         else if (i === 1) {\r\n           if (j === 1 || j === 2) {\r\n             retVal = true;\r\n           }\r\n         }\r\n         else if (i === 2) {\r\n           if (j === 2) {\r\n             retVal = true;\r\n           }\r\n         }\r\n         else if (i === 3) {\r\n           if (j === 3) {\r\n             retVal = true;\r\n           }\r\n         }\r\n       }\r\n\r\n       return retVal;\r\n     };\r\n    }\r\n\r\n\tfunction getWebMaps(webmaps) {\r\n\t  if (webmaps.indexOf(',') !== -1) {\r\n\t\tvar mapIds = webmaps.split(',');\r\n\t\twebmapresults = dojo.map(mapIds, function (mapId) {\r\n\t\t  return {\r\n\t\t\tid: mapId\r\n\t\t  };\r\n\t\t});\r\n\t  } else {\r\n\t\tvar previewWebMap = {\r\n\t\t  id: webmaps\r\n\t\t};\r\n\t\twebmapresults = [previewWebMap];\r\n\t  }\r\n\t  return webmapresults;\r\n\t}\r\n\r\n\tfunction getTabs(tabs){\r\n\t\tif (tabs.indexOf(',') !== -1) {\r\n\t\tvar mapIds = tabs.split(',');\r\n\t\ttabresults = dojo.map(mapIds, function (mapId) {\r\n\t\t  return {\r\n\t\t\ttitle: mapId\r\n\t\t  };\r\n\t\t});\r\n\t  } else {\r\n\t\tvar previewTab = {\r\n\t\t  title: tabs\r\n\t\t};\r\n\t\ttabresults = [previewTab];\r\n\t  }\r\n\t  return tabresults;\r\n\t}\r\n\r\n\tfunction timeoutError(){\r\n\t\tif (timeoutComplete == false && mapsLoaded < configOptions.webmaps.length - 1){\r\n\t\t\ttimeoutComplete = true;\r\n\t\t\tmapsLoaded = configOptions.webmaps.length - 1;\r\n\t\t\tmapLoaded();\r\n\t\t}\r\n\t}"]],"start1":0,"start2":0,"length1":0,"length2":21904}]],"length":21904}
{"contributors":[],"silentsave":true,"ts":1357943083621,"patch":[[{"diffs":[[0,"\r\n\t\t\t   "],[1,"//"],[0,"createMa"]],"start1":6274,"start2":6274,"length1":16,"length2":18}]],"length":21906,"saved":false}
{"ts":1357943085617,"patch":[[{"diffs":[[0,"se{\r\n\t\t\t"],[1,"//"],[0,"createMa"]],"start1":6451,"start2":6451,"length1":16,"length2":18}]],"length":21908,"saved":false}
{"contributors":[],"silentsave":false,"ts":1358199528449,"patch":[[{"diffs":[[0,"apLoaded();\r\n\t\t}\r\n\t}"],[1,"\r\n  \r\n  function showPlaces(){\r\n    document.getElementById(\"app\").contentWindow.showPlacePoints();\r\n  }\r\n  \r\n  function showSocialMedia(){\r\n    document.getElementById(\"app\").contentWindow.showSocialMediaPoints();\r\n  }"]],"start1":21888,"start2":21888,"length1":20,"length2":239}]],"length":22127,"saved":false}
{"contributors":[],"silentsave":true,"ts":1358203092048,"patch":[[{"diffs":[[0,"nts();\r\n"],[1,"    $()\r\n"],[0,"  }\r\n  \r"]],"start1":22001,"start2":22001,"length1":16,"length2":25}]],"length":22136,"saved":false}
{"ts":1358203093469,"patch":[[{"diffs":[[0,"\r\n    $("],[1,"\"\""],[0,")\r\n  }\r\n"]],"start1":22007,"start2":22007,"length1":16,"length2":18}]],"length":22138,"saved":false}
{"ts":1358203099890,"patch":[[{"diffs":[[0,"\t}\r\n\t}\r\n"],[-1,"  "],[0,"\r\n  func"]],"start1":21902,"start2":21902,"length1":18,"length2":16},{"diffs":[[0,")\r\n  }\r\n"],[-1,"  "],[0,"\r\n  func"]],"start1":22015,"start2":22015,"length1":18,"length2":16}]],"length":22134,"saved":false}
{"ts":1358203101514,"patch":[[{"diffs":[[0,"\n    $(\""],[1,"#place"],[0,"\")\r\n  }\r"]],"start1":22006,"start2":22006,"length1":16,"length2":22}]],"length":22140,"saved":false}
{"ts":1358203102282,"patch":[[{"diffs":[[0,"(\"#place"],[1,"L"],[0,"\")\r\n  }\r"]],"start1":22012,"start2":22012,"length1":16,"length2":17}]],"length":22141,"saved":false}
{"ts":1358203103459,"patch":[[{"diffs":[[0,"\"#placeL"],[1,"ege"],[0,"\")\r\n  }\r"]],"start1":22013,"start2":22013,"length1":16,"length2":19}]],"length":22144,"saved":false}
{"ts":1358203105990,"patch":[[{"diffs":[[0,"laceLege"],[1,"nd"],[0,"\")\r\n  }\r"]],"start1":22016,"start2":22016,"length1":16,"length2":18}]],"length":22146,"saved":false}
{"ts":1358203108348,"patch":[[{"diffs":[[0,"Legend\")"],[1,".show()"],[0,"\r\n  }\r\n\r"]],"start1":22020,"start2":22020,"length1":16,"length2":23}]],"length":22153,"saved":false}
{"ts":1358203109323,"patch":[[{"diffs":[[0,"\").show("],[1,"_"],[0,")\r\n  }\r\n"]],"start1":22026,"start2":22026,"length1":16,"length2":17}]],"length":22154,"saved":false}
{"ts":1358203113757,"patch":[[{"diffs":[[0,"how("],[-1,"_"],[0,")"],[1,";"],[0,"\r\n  "]],"start1":22030,"start2":22030,"length1":10,"length2":10}]],"length":22154,"saved":false}
{"ts":1358203117643,"patch":[[{"diffs":[[0,"how();\r\n"],[1,"    $(\"#placeLegend\").show();\r\n"],[0,"  }\r\n\r\n "]],"start1":22030,"start2":22030,"length1":16,"length2":47}]],"length":22185,"saved":false}
{"ts":1358203127016,"patch":[[{"diffs":[[0,"how();\r\n    $(\"#"],[-1,"place"],[1,"social"],[0,"Legend\").show();"]],"start1":22030,"start2":22030,"length1":37,"length2":38}]],"length":22186,"saved":false}
{"ts":1358203130340,"patch":[[{"diffs":[[0,"ialLegend\")."],[-1,"show"],[1,"hide"],[0,"();\r\n  }\r\n\r\n"]],"start1":22049,"start2":22049,"length1":28,"length2":28}]],"length":22186,"saved":false}
{"ts":1358203138170,"patch":[[{"diffs":[[0,"aPoints();\r\n"],[1,"    $(\"#placeLegend\").show();\r\n    $(\"#socialLegend\").hide();\r\n"],[0,"  }"]],"start1":22171,"start2":22171,"length1":15,"length2":78}]],"length":22249,"saved":false}
{"ts":1358203141655,"patch":[[{"diffs":[[0,"\"#placeLegend\")."],[-1,"show"],[1,"hide"],[0,"();\r\n    $(\"#soc"]],"start1":22189,"start2":22189,"length1":36,"length2":36}]],"length":22249,"saved":false}
{"contributors":[],"silentsave":true,"ts":1358203161408,"patch":[[{"diffs":[[0,"#socialLegend\")."],[-1,"hide"],[1,"show"],[0,"();\r\n  }"]],"start1":22221,"start2":22221,"length1":28,"length2":28}]],"length":22249,"saved":false}
